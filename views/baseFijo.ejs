<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Base Fijo - Favtel CRM</title>

  <!-- âœ… DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.6/css/dataTables.dataTables.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.1.2/css/buttons.dataTables.css">

  <style>
    h1, h2 { text-align: center; margin-top: 1rem; }
    .table-container { padding: 2rem; }
    .btn-edit {
      color: #fff;
      background: #0d6efd;
      border: none;
      padding: 4px 8px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div class="container-fluid table-container">
    <h1>Base Fijo</h1>

    <h2>Usuario:
      <% if (user) { %>
        <span class="badge bg-success"><%= user.nombre %></span>
      <% } %>
    </h2>

    <hr>

    <div class="table-responsive">
      <table id="ventas" class="table table-striped table-bordered nowrap" style="width:100%">
        <thead class="table-dark">
          <tr>
            <th>Acciones</th>
            <th>Consecutivo</th>
            <th>NÃºmero</th>
            <th>CÃ©dula</th>
            <th>Nombre</th>
            <th>Asesor</th>
            <th>Detalle</th>
            <th>Comentario</th>
            <th>Pre/Post Pago</th>
            <th>Fijo</th>
            <th>Operador Fijo</th>
            <th>Operador MÃ³vil</th>
            <th>GÃ©nero</th>
            <th>WhatsApp</th>
            <th>Cobertura Fijo</th>
            <th>Coordenadas</th>
          </tr>
        </thead>

        <tbody>
          <% results.forEach(row => { %>
            <tr>
              <td>
                <a href="/editBaseFijo/<%= row.consecutivo %>" class="btn btn-sm btn-primary">Editar</a>
              </td>
              <td><%= row.consecutivo || '' %></td>
              <td><%= row.numero || '' %></td>
              <td><%= row.cedula || '' %></td>
              <td><%= row.nombre || '' %></td>
              <td><%= row.asesor || '' %></td>
              <td><%= row.detalle || '' %></td>
              <td><%= row.comentario || '' %></td>
              <td><%= row.pre_post_pago || '' %></td>
              <td><%= row.fijo || '' %></td>
              <td><%= row.operador_fijo || '' %></td>
              <td><%= row.operador_movil || '' %></td>
              <td><%= row.genero || '' %></td>
              <td><%= row.whatsapp || '' %></td>
              <td><%= row.cobertura_fijo || '' %></td>
              <td><%= row.coordenadas || '' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <div class="text-center mt-4">
      <a href="/registrarVentaFijo" class="btn btn-success">Registrar Nueva Venta</a>
    </div>
  </div>

  <!-- âœ… Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <script src="https://cdn.datatables.net/2.1.6/js/dataTables.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.1.2/js/dataTables.buttons.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.1.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.1.2/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <script>
    $(document).ready(function () {
      const table = new DataTable('#ventas', {
        scrollX: true,
        layout: {
          topStart: { buttons: ['copy', 'csv', 'excel', 'pdf', 'print'] }
        },
        language: { url: "https://cdn.datatables.net/plug-ins/2.1.6/i18n/es-ES.json" }
      });

      // ðŸ”’ Auto-filter by user (if not admin)
      const userRol = "<%= user.rol %>";
      if (userRol !== "admin") {
        const nombre = "<%= user.nombre %>";
        table.column(5).search(nombre).draw(); // 6th column = "Asesor"
      }
    });
  </script>
</body>
</html>
